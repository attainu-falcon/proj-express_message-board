<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="/styles/styles.css">
    <title>Topics</title>
</head>
<body>
    <header class="category-container">
      <form action="/topics"><button class="back" onclick="back()"><</button></form>
        <ul>
            <li><a href="#">Latest</a></li><!--
         --><li>Top Users</li><!--
         --><li>Top Posts</li>
        </ul>
        <div class="toolbar">
        <h2 class="topic-heading" data-id="5d1311e66b4186f06c58c178">#Jquery</h2>
        <button class="post-button" >post!</button>
        </div>
    </header>
    <main class="posts-container">
        <ul>
            <!-- <li><a href="/post">Username - Post</a></li> -->
        </ul>
    </main>
    <script>
        let id  = document.querySelector('.topic-heading').getAttribute('data-id')
        fetch('/postlist' + window.location.search)
        .then(res=>res.json())
        .then(result=>renderUI(result))
        .catch(err=> console.log(err))
        
        function renderUI(result) {
            for (post of result[0].posts) {
                let li = document.createElement('li')
                let a = document.createElement('a')
                a.textContent = post.content
                a.setAttribute('onclick', 'postClick("' + post._id + '")') 
                li.appendChild(a)
                document.querySelector('.posts-container ul').prepend(li)
            }
        }   
        
        function postClick(id){
            let url = 'post' + window.location.search + '&postid=' + id
            window.location.replace(url) 
        }
        
        document.querySelector('.post-button').addEventListener('click', function(){
            window.location.replace('post' + window.location.search)
        })

        function back() {
            // let urlParams = new URLSearchParams(window.location.search)
            // console.log(urlParams.has('post'))
            // let id = urlParams.get('topicid')
            window.location.replace('/topics')
        }
    </script>
</body>
</html>
